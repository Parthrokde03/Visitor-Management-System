
<odoo>
  <!-- 1) Paperformat: 100 x 150 mm label, no margins -->
  <record id="paperformat_visitor_pass" model="report.paperformat">
    <field name="name">Visitor Pass (100x150)</field>
    <field name="default" eval="False" />
    <field name="format">custom</field>
    <field name="page_width">75</field>      <!-- mm -->
    <field name="page_height">100</field>     <!-- mm -->
    <field name="orientation">Landscape</field>
    <field name="margin_top">0</field>
    <field name="margin_bottom">0</field>
    <field name="margin_left">0</field>
    <field name="margin_right">0</field>
    <field name="header_line" eval="False" />
    <field name="dpi">96</field>
  </record>

  <!-- 2) Report action -->
  <record id="action_visit_report" model="ir.actions.report">
    <field name="name">Visitor Pass</field>
    <field name="model">visit.information</field>
    <field name="report_type">qweb-html</field>
    <field name="report_name">visitor_management.badge_report</field>
    <field name="report_file">visitor_management.badge_report</field>
    <field name="binding_model_id" ref="visitor_management.model_visit_information" />
    <field name="binding_type">report</field>
    <field name="print_report_name">'Visitor Pass - %s' % (object.name)</field>
    <field name="paperformat_id" ref="visitor_management.paperformat_visitor_pass" />
  </record>

  <!-- 3) QWeb template -->
  <template id="badge_report">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="o">
        <t t-call="web.external_layout">
          <div class="page">
            <style>
              @page { size: 150mm 100mm; margin: 0; }
              .page { width:150mm !important; min-height:100mm !important; height:100mm !important;
              margin:0 !important; padding:0 !important; }
              <!-- * {
  border: 0 !important;
  outline: 0 !important;
  box-shadow: 0 !important;
}


div, table, tr, td, th {
  border: 0 !important;
  outline: 0 !important;
} -->








              .badge-page{ width:150mm; 
                height:100mm;
                box-sizing:border-box; 
                padding:5mm; }
              .badge-card{
              width:100%; 
              height:100%;
              border:0.8mm solid #111; 
              border-radius:4mm;
              box-sizing:border-box; 
              
              padding:4mm 5mm; 
              position:relative; 
              font-family: Arial, Helvetica, sans-serif;
              }

              /* wkhtml-friendly table layout */
              .tbl{ width:100%; height:100%; 
                border-collapse:collapse;
                 }
              .tbl td{ vertical-align:top; }
              .td-left{ width:60%; padding-right:4mm; }
              .td-right{ width:40%; }
             



              .photo{ width:35mm; height:35mm; border-radius:50%; overflow:hidden; }
              .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

              .v-name{ font-size:6mm; line-height:1.05; font-weight:800; margin:1mm 0 0; }
              .v-lines{ font-size:3.3mm; line-height:1.25; }
              .v-lines p{ margin:0.8mm 0; }

              .logo-box{
              height:18mm; border:0.5mm dashed #bdbdbd; border-radius:2mm;
              text-align:center; box-sizing:border-box; padding:1mm;
              }
              .logo-box img{ max-width:100%; max-height:100%; display:inline-block; }

              .qr-box{
              width:40mm; height:40mm; border:0.6mm solid #000; border-radius:1mm;
              padding:1mm; box-sizing:border-box; position:absolute; right:7mm; bottom:7mm;
              }
              .qr-box img{ width:100%; height:100%; display:block; }

              .page, .badge-page, .badge-card { page-break-inside: avoid; }
              .signature_container {
              margin-top: 15px;
              display: flex;
              align-items: center;
              gap: 10px;
              }
              .signature_label {
              font-size: small;
              color: gray;
              font-weight: bold;
              white-space: nowrap;
              }
              .signature_box {
              width: 180px;
              height: 35px;
              border: 1px solid #999 !important;
              border-radius: 4px !important;
              display: inline-block;
              }
            </style>

            <div class="badge-page">
              <div class="badge-card">
                <table class="tbl table-borderless">
                  <tr>
                    <td class="td-left">
                      <div class="photo">
                        <!-- safer to serve as PNG via /web/image (optional but recommended) -->
                        <img t-if="o.photo_answer"
                          t-att-src="'/web/image/visit.information/%s/photo_answer?mimetype=image/png' % o.id" />
                      </div>

                      <div class="v-name">
                        <t t-esc="o.name or ''" />
                      </div>
                      <div class="v-lines">
                        <p t-if="o.company">
                          <t t-esc="o.company" />
                        </p>
                        <p t-if="o.employee">
                          <t t-esc="'Visiting %s' % (o.employee.name or '')" />
                        </p>
                        <p t-if="o.visiting_date">
                          <t t-esc="o.visiting_date.strftime('%Y-%m-%d %H:%M:%S')" />
                        </p>
                        <p t-if="o.id">Visitor ID <t t-esc="o.id" /></p>
                      </div>
                      <!-- <div class="signature_container">
                        <span class="signature_label">Signature of employee:</span>
                        <div class="signature_box"></div>
                      </div> -->
                      <div>
                        <span class="signature_label">Signature of employee:</span>
                        <div class="signature_box" ></div>
                      </div>
                    </td>

                    <td class="td-right">
                      <t t-set="company" t-value="o.company_id or env.company" />
                      <div class="logo-box">
                        <!-- Check if company logo exists and render it -->
                        <img t-if="company and company.logo"
                          t-att-src="'%s/web/image/res.company/%s/logo?mimetype=image/png' % (env['ir.config_parameter'].sudo().get_param('web.base.url'), company.id)" />
                        <t t-if="not (company and company.logo)">Your Logo Here</t>
                      </div>
                    </td>

                  </tr>
                </table>

                <!-- QR (query-param API + urlencode) -->

                <t t-if="o.qr_token">
                  <div class="qr-box">
                    <t t-set="base_url"
                      t-value="env['ir.config_parameter'].sudo().get_param('web.base.url')" />
                    <img class="qr_img"
                      t-att-src="'/report/barcode/QR/' + base_url + '/visitor/verify/' + o.qr_token"
                      alt="QR Code" />
                  </div>
                </t>


              </div>
            </div>
          </div>
        </t>
      </t>
    </t>
  </template>


</odoo>